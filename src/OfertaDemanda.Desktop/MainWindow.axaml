<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
        xmlns:views="using:OfertaDemanda.Desktop.Views"
        mc:Ignorable="d"
        x:Class="OfertaDemanda.Desktop.MainWindow"
        Width="1200"
        Height="800"
        Title="{Binding Localization[App_Title]}"
        Icon="avares://OfertaDemanda.Desktop/Assets/icon_1024.png"
        x:CompileBindings="False">
    <Grid RowDefinitions="Auto,*" Margin="16">
        <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Stretch"
                    Margin="0,0,0,12">
            <TextBlock Text="{Binding Localization[Main_HeaderTitle]}"
                       FontSize="22"
                       FontWeight="Bold" />
            <Button Content="{Binding Localization[Main_ResetDefaults]}"
                    Command="{Binding ResetDefaultsCommand}"
                    Margin="16,0,0,0" />
        </StackPanel>

        <TabControl Grid.Row="1"
                    TabStripPlacement="Top">
            <TabItem Header="{Binding Localization[Tab_Market]}">
                <Grid ColumnDefinitions="340,*"
                      ColumnSpacing="16"
                      DataContext="{Binding Market}">
                    <ScrollViewer Grid.Column="0"
                                  VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="12">
                            <TextBlock Text="{Binding Localization[Market_Functions]}"
                                       FontWeight="Bold" />
                            <TextBlock Text="{Binding Localization[Market_DemandInverse]}" />
                            <TextBox Text="{Binding DemandExpression, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="{Binding Localization[Market_SupplyInverse]}"
                                       Margin="0,8,0,0" />
                            <TextBox Text="{Binding SupplyExpression, UpdateSourceTrigger=PropertyChanged}" />

                            <TextBlock Text="{Binding Localization[Market_ShocksTax]}"
                                       FontWeight="Bold"
                                       Margin="0,16,0,0" />
                            <TextBlock Text="{Binding Localization[Market_DemandShock]}" />
                            <Slider Minimum="-30"
                                    Maximum="30"
                                    Value="{Binding DemandShock}"
                                    TickFrequency="5" />
                            <TextBlock Text="{Binding DemandShockText}"
                                       FontSize="12" />

                            <TextBlock Text="{Binding Localization[Market_SupplyShock]}"
                                       Margin="0,8,0,0" />
                            <Slider Minimum="-30"
                                    Maximum="30"
                                    Value="{Binding SupplyShock}"
                                    TickFrequency="5" />
                            <TextBlock Text="{Binding SupplyShockText}"
                                       FontSize="12" />

                            <TextBlock Text="{Binding Localization[Market_Tax]}"
                                       Margin="0,8,0,0" />
                            <Slider Minimum="0"
                                    Maximum="30"
                                    Value="{Binding Tax}"
                                    TickFrequency="5" />
                            <TextBlock Text="{Binding TaxText}"
                                       FontSize="12" />

                            <TextBlock Text="{Binding Localization[Market_Costs]}"
                                       FontWeight="Bold"
                                       Margin="0,16,0,0" />
                            <TextBlock Text="{Binding Localization[Market_CostType]}" />
                            <ComboBox ItemsSource="{Binding CostTypeOptions}"
                                      SelectedItem="{Binding SelectedCostType}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Label}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <TextBlock Text="{Binding Localization[Market_CostFixed]}"
                                       Margin="0,8,0,0" />
                            <TextBox Text="{Binding FixedCost, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="{Binding Localization[Market_CostLinear]}"
                                       Margin="0,8,0,0" />
                            <TextBox Text="{Binding LinearCost, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="{Binding Localization[Market_CostQuadratic]}"
                                       Margin="0,8,0,0" />
                            <TextBox Text="{Binding QuadraticCost, UpdateSourceTrigger=PropertyChanged}" />
                            <StackPanel IsVisible="{Binding IsCubicCostVisible}">
                                <TextBlock Text="{Binding Localization[Market_CostCubic]}"
                                           Margin="0,8,0,0" />
                                <TextBox Text="{Binding CubicCost, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>

                            <TextBlock Text="{Binding Localization[Market_CurvesElements]}"
                                       FontWeight="Bold"
                                       Margin="0,12,0,0" />
                            <StackPanel Orientation="Horizontal"
                                        Spacing="8">
                                <Button Content="{Binding Localization[Market_ShowAll]}"
                                        Command="{Binding ShowAllTogglesCommand}" />
                                <Button Content="{Binding Localization[Market_HideAll]}"
                                        Command="{Binding HideAllTogglesCommand}" />
                            </StackPanel>
                            <ItemsControl ItemsSource="{Binding ToggleGroups}"
                                          Margin="0,6,0,0">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Margin="0,8,0,0">
                                            <StackPanel Orientation="Horizontal"
                                                        Spacing="8">
                                                <TextBlock Text="{Binding Label}"
                                                           FontWeight="SemiBold" />
                                                <Button Content="{Binding DataContext.Localization[Market_ShowGroup], RelativeSource={RelativeSource AncestorType=ScrollViewer}}"
                                                        Command="{Binding DataContext.ShowGroupCommand, RelativeSource={RelativeSource AncestorType=ScrollViewer}}"
                                                        CommandParameter="{Binding}" />
                                            </StackPanel>
                                            <ItemsControl ItemsSource="{Binding Items}"
                                                          Margin="0,4,0,0">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <CheckBox Content="{Binding Label}"
                                                                  IsChecked="{Binding IsVisible}" />
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <TextBlock Text="{Binding Localization[Market_Results]}"
                                       FontWeight="Bold"
                                       Margin="0,16,0,0" />
                            <WrapPanel>
                                <TextBlock Text="{Binding EquilibriumText}" />
                                <TextBlock Text="{Binding PriceConsumerText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding PriceProducerText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding ConsumerSurplusText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding ProducerSurplusText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding TaxRevenueText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding DeadweightLossText}" Margin="8,0,0,0" />
                            </WrapPanel>

                            <TextBlock Text="{Binding Localization[Market_FirmCompetitive]}"
                                       FontWeight="Bold"
                                       Margin="0,12,0,0" />
                            <WrapPanel>
                                <TextBlock Text="{Binding FirmQuantityText}" />
                                <TextBlock Text="{Binding FirmMarginalCostText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding FirmAverageVariableCostText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding FirmAverageCostText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding FirmProfitText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding FirmStateText}" Margin="8,0,0,0" />
                            </WrapPanel>

                            <Border Margin="0,12,0,0"
                                    Padding="10"
                                    CornerRadius="6"
                                    Background="{DynamicResource ThemeControlLowBrush}">
                                <StackPanel>
                                    <TextBlock Text="{Binding Localization[Market_Explanation_Title]}"
                                               FontWeight="SemiBold"
                                               Margin="0,0,0,6" />
                                    <StackPanel Margin="0,4,0,0">
                                        <TextBlock Text="{Binding Localization[Market_Explanation_MC_Title]}"
                                                   FontWeight="SemiBold" />
                                        <TextBlock Text="{Binding Localization[Market_Explanation_MC_Body]}"
                                                   FontSize="12"
                                                   Opacity="0.75" />
                                    </StackPanel>
                                    <StackPanel Margin="0,6,0,0">
                                        <TextBlock Text="{Binding Localization[Market_Explanation_AVC_Title]}"
                                                   FontWeight="SemiBold" />
                                        <TextBlock Text="{Binding Localization[Market_Explanation_AVC_Body]}"
                                                   FontSize="12"
                                                   Opacity="0.75" />
                                    </StackPanel>
                                    <StackPanel Margin="0,6,0,0">
                                        <TextBlock Text="{Binding Localization[Market_Explanation_AC_Title]}"
                                                   FontWeight="SemiBold" />
                                        <TextBlock Text="{Binding Localization[Market_Explanation_AC_Body]}"
                                                   FontSize="12"
                                                   Opacity="0.75" />
                                    </StackPanel>
                                    <StackPanel Margin="0,6,0,0">
                                        <TextBlock Text="{Binding Localization[Market_Explanation_Profit_Title]}"
                                                   FontWeight="SemiBold" />
                                        <TextBlock Text="{Binding Localization[Market_Explanation_Profit_Body]}"
                                                   FontSize="12"
                                                   Opacity="0.75" />
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <Border Margin="0,12,0,0"
                                    Padding="8"
                                    Background="#3FFFF0F0"
                                    CornerRadius="4"
                                    IsVisible="{Binding HasErrors}">
                                <StackPanel>
                                    <TextBlock Text="{Binding Localization[Common_Errors]}"
                                               FontWeight="Bold" />
                                    <ItemsControl ItemsSource="{Binding Errors}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="• {Binding}" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <lvc:CartesianChart Grid.Column="1"
                                        Series="{Binding Series}"
                                        XAxes="{Binding XAxes}"
                                        YAxes="{Binding YAxes}"
                                        LegendPosition="Right" />
                </Grid>
            </TabItem>

            <TabItem Header="{Binding Localization[Tab_Firm]}">
                <Grid ColumnDefinitions="340,*"
                      ColumnSpacing="16"
                      DataContext="{Binding Firm}">
                    <ScrollViewer Grid.Column="0"
                                  VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="12">
                            <TextBlock Text="{Binding Localization[Firm_CostMode_Title]}"
                                       FontWeight="Bold" />
                            <TextBlock Text="{Binding Localization[Firm_TotalCost_Label]}" />
                            <TextBox Text="{Binding CostExpression, UpdateSourceTrigger=PropertyChanged}" />

                            <TextBlock Text="{Binding Localization[Firm_Mode_Label]}"
                                       Margin="0,8,0,0" />
                            <ComboBox ItemsSource="{Binding ModeOptions}"
                                      SelectedItem="{Binding SelectedMode}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Label}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <TextBlock Text="{Binding Localization[Firm_MarketPrice_Label]}"
                                       Margin="0,8,0,0" />
                            <Slider Minimum="10"
                                    Maximum="100"
                                    Value="{Binding Price}"
                                    IsEnabled="{Binding IsPriceEditable}" />
                            <TextBlock Text="{Binding CurrentPriceText}"
                                       FontSize="12" />

                            <TextBlock Text="{Binding Localization[Common_Results]}"
                                       FontWeight="Bold"
                                       Margin="0,16,0,0" />
                            <WrapPanel>
                                <TextBlock Text="{Binding QuantityText}" />
                                <TextBlock Text="{Binding PriceText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding ProfitText}" Margin="8,0,0,0" />
                            </WrapPanel>

                            <Border Margin="0,12,0,0"
                                    Padding="8"
                                    Background="#3FFFF0F0"
                                    CornerRadius="4"
                                    IsVisible="{Binding HasErrors}">
                                <StackPanel>
                                    <TextBlock Text="{Binding Localization[Common_Errors]}"
                                               FontWeight="Bold" />
                                    <ItemsControl ItemsSource="{Binding Errors}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="• {Binding}" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <lvc:CartesianChart Grid.Column="1"
                                        Series="{Binding Series}"
                                        XAxes="{Binding XAxes}"
                                        YAxes="{Binding YAxes}"
                                        LegendPosition="Right" />
                </Grid>
            </TabItem>

            <TabItem Header="{Binding Localization[Tab_Monopoly]}">
                <Grid ColumnDefinitions="340,*"
                      ColumnSpacing="16"
                      DataContext="{Binding Monopoly}">
                    <ScrollViewer Grid.Column="0"
                                  VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="12">
                            <TextBlock Text="{Binding Localization[Monopoly_DemandInverse_Label]}"
                                       FontWeight="Bold" />
                            <TextBox Text="{Binding DemandExpression, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="{Binding Localization[Monopoly_TotalCost_Label]}"
                                       Margin="0,8,0,0" />
                            <TextBox Text="{Binding CostExpression, UpdateSourceTrigger=PropertyChanged}" />

                            <TextBlock Text="{Binding Localization[Common_Results]}"
                                       FontWeight="Bold"
                                       Margin="0,16,0,0" />
                            <WrapPanel>
                                <TextBlock Text="{Binding MonopolyQuantityText}" />
                                <TextBlock Text="{Binding MonopolyPriceText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding ProfitText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding CompetitiveQuantityText}" Margin="8,0,0,0" />
                                <TextBlock Text="{Binding DeadweightLossText}" Margin="8,0,0,0" />
                            </WrapPanel>

                            <TextBlock Text="{Binding Localization[Monopoly_Visualization_Title]}"
                                       FontWeight="Bold"
                                       Margin="0,16,0,0" />
                            <StackPanel Spacing="6">
                                <CheckBox Content="{Binding Localization[Monopoly_Toggle_Isoprofit]}"
                                          IsChecked="{Binding ShowIsoprofitCurve}" />
                                <CheckBox Content="{Binding Localization[Monopoly_Toggle_AverageCost]}"
                                          IsChecked="{Binding ShowAverageCost}" />
                                <CheckBox Content="{Binding Localization[Monopoly_Toggle_Guides]}"
                                          IsChecked="{Binding ShowGuideLines}" />
                                <CheckBox Content="{Binding Localization[Monopoly_Toggle_Deadweight]}"
                                          IsChecked="{Binding ShowDeadweightArea}" />
                            </StackPanel>

                            <Border Margin="0,12,0,0"
                                    Padding="8"
                                    Background="#1A1E88E5"
                                    CornerRadius="4">
                                <StackPanel Spacing="6">
                                    <TextBlock Text="{Binding Localization[Common_Explanation]}"
                                               FontWeight="Bold" />
                                    <TextBlock Text="{Binding IsoprofitExplanation}"
                                               FontSize="12"
                                               TextWrapping="Wrap" />
                                </StackPanel>
                            </Border>

                            <Border Margin="0,12,0,0"
                                    Padding="8"
                                    Background="#3FFFF0F0"
                                    CornerRadius="4"
                                    IsVisible="{Binding HasErrors}">
                                <StackPanel>
                                    <TextBlock Text="{Binding Localization[Common_Errors]}"
                                               FontWeight="Bold" />
                                    <ItemsControl ItemsSource="{Binding Errors}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="• {Binding}" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <lvc:CartesianChart Grid.Column="1"
                                        Series="{Binding Series}"
                                        XAxes="{Binding XAxes}"
                                        YAxes="{Binding YAxes}"
                                        LegendPosition="Right" />
                </Grid>
            </TabItem>

            <TabItem Header="{Binding Localization[Tab_Elasticity]}">
                <Grid ColumnDefinitions="340,*"
                      ColumnSpacing="16"
                      DataContext="{Binding Elasticity}">
                    <ScrollViewer Grid.Column="0"
                                  VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="12">
                            <TextBlock Text="{Binding Localization[Elasticity_UsesMarketDemand]}"
                                       FontWeight="Bold" />
                            <TextBlock Text="{Binding Localization[Elasticity_Demand_Label]}" />
                            <TextBox Text="{Binding Market.DemandExpression, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="{Binding MarketShockText}"
                                       FontSize="12" />

                            <TextBlock Text="{Binding Localization[Elasticity_Price_Label]}"
                                       Margin="0,12,0,0" />
                            <Slider Minimum="10"
                                    Maximum="110"
                                    Value="{Binding Price}" />
                            <TextBlock Text="{Binding PriceText}"
                                       FontSize="12" />

                            <TextBlock Text="{Binding ElasticityText}"
                                       Margin="0,12,0,0" />

                            <Border Margin="0,12,0,0"
                                    Padding="8"
                                    Background="#3FFFF0F0"
                                    CornerRadius="4"
                                    IsVisible="{Binding HasErrors}">
                                <StackPanel>
                                    <TextBlock Text="{Binding Localization[Common_Errors]}"
                                               FontWeight="Bold" />
                                    <ItemsControl ItemsSource="{Binding Errors}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="• {Binding}" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <lvc:CartesianChart Grid.Column="1"
                                        Series="{Binding Series}"
                                        XAxes="{Binding XAxes}"
                                        YAxes="{Binding YAxes}"
                                        LegendPosition="Right" />
                </Grid>
            </TabItem>

            <TabItem Header="{Binding Localization[Tab_IsoBenefit]}">
                <views:IsoBenefitView DataContext="{Binding IsoBenefit}" />
            </TabItem>

            <TabItem Header="{Binding Localization[Tab_Settings]}">
                <views:SettingsView DataContext="{Binding Settings}" />
            </TabItem>

            <TabItem Header="{Binding Localization[Tab_About]}">
                <views:AboutView DataContext="{Binding About}" />
            </TabItem>
        </TabControl>
    </Grid>
</Window>
